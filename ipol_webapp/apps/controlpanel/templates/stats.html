{% extends 'base/base.html' %}
{% load staticfiles %}
{% load i18n %}

{% block title %}
    HW
{% endblock %}

{% block cssfiles %}

    <style type="text/css">
        .ststsok {
            color:green;

        }
        .ststsnok {
            color:red;

        }
        .machine{
            border: 1px solid black;
            margin: 20px;
            padding: 10px;
        }
        .container{
            margin: 20px;
            padding: 10px;
        }
    </style>

{% endblock %}

{% block content %}

    <div class="container">
        <h1>
            <p>SYSTEM STATS</p>
        </h1>


        {% with archive_module_stats=view.get_archive_module_stats blobs_module_stats=view.get_blobs_module_stats archivemachine=view.get_archive_machine  blobmachine=view.get_blob_machine demomachine=view.get_demo_machine  demoinfo_module_stats=view.get_demoinfo_module_stats  demoinfomachine=view.get_demoinfo_machine%}
            {% if '127.0.0.1' in archivemachine or '127.0.0.1' in blobmachine or '127.0.0.1' in demomachine %}
                <b class="ststsnok">Carefull! Some stuff is running locally</b>
                <p> To RUN Locally DEMO: (v_env_ipol)josearrecio@Joses-MacBook-Pro:~/Projects/ipolDevel/ipol_demo$ python demo.py  (needs buil)</p>
                <p> To RUN Locally ARCHIVE: (v_env_ipol)josearrecio@Joses-MacBook-Pro:~/Projects/ipolDevel/ipol_demo/modules/archive$ python main.py archive.josearrecio.conf</p>
                <p> To RUN Locally BLOBS: (v_env_ipol)josearrecio@Joses-MacBook-Pro:~/Projects/ipolDevel/ipol_demo/modules/blobs$ python main.py blobs.josearrecio.conf </p>
                <p> Note: Some modules have .conf hardcoded, you have to: cp archive.josearrecio.conf archive.conf </p>

            {% endif %}


            <div id="demoinfo_module_info" class="machine">
                {% if demoinfo_module_stats.status == "OK" %}

                    <p class="ststsok"> <b>DEMOINFO RUNNING at: {{ demoinfomachine }}</b></p>

                    <div style="padding-left: 20px">
                        <p>nb_demos: {{ demoinfo_module_stats.nb_demos  }}</p>
                        <p>nb_authors: {{ demoinfo_module_stats.nb_authors  }}</p>
                        <p>nb_editors: {{ demoinfo_module_stats.nb_editors  }}</p>
                    </div>


                {% else %}
                    <p class="ststsnok">Demoinfo Module Not running!</p>
                {% endif %}
            </div>


            <div id="archive_module_info" class="machine">
                {% if archive_module_stats.status == "OK" %}

                    <p class="ststsok"> <b>ARCHIVE RUNNING at: {{ archivemachine }}</b></p>

                    <div style="padding-left: 20px">
                        <p>nb_blobs: {{ archive_module_stats.nb_blobs  }}</p>
                        <p>nb_experiments: {{ archive_module_stats.nb_experiments  }}</p>
                    </div>

                    {#boton shutdown#}
                    <div style="padding-left: 20px" >
                        <a class="btn btn-primary" onclick="send_archive_shutdown_request()">Shutdown Archive</a>
                    </div>

                    <p>For testing purposes Archive module has experiment with id=-1, you can add experiments to it (an experiment consists of two pokemon images)</p>
                    <div style="padding-left: 20px" >
                        <a class="btn btn-primary" onclick="send_add_test_to_test_demo('{% url 'ipol.cp.archive.add_exp_to_test_demo' %}' )">Add experiment to test demo</a>
                    </div>

                {% else %}

                    <p class="ststsnok">Archive Module Not running!</p>

                {% endif %}
            </div>


            <div id="blobs_module_info" class="machine">
                {% if blobs_module_stats %}
                    <p class="ststsok"><b>BLOBS RUNNING at: {{ blobmachine }}</b></p>
                    <div style="padding-left: 20px">
                        {% for demo in blobs_module_stats.list_demos%}
                            ( demo_id:{{ demo.id }}, name:{{ demo.name }} )
                            {#   <p style="padding-left: 20px">is_template:{{ is_template.id }} </p>#}
                            {#   <p style="padding-left: 20px">template_id:{{ demo.template_id }} </p>#}
                        {% endfor %}
                    </div>

                {% else %}
                    <p class="ststsnok">Blobs Module Not running!</p>

                {% endif %}
            </div>


            <div id="Demo_module_info" class="machine">

                <p class="ststsnok"> No integration with archive module, it has its own archive in ipol_Demo/libs/archive.py (its like blobs and archive mixed together)</p>
                <p class="ststsnok"> No integration with Blobs module, </p>
                {% if demomachine %}
                    <p class="ststsok"><b>Demo RUNNING at: {{ demomachine }}</b></p>
                {% else %}
                    <p class="ststsnok"><b>Demo NOT RUNNING </b></p>
                {% endif %}



            </div>

        {% endwith %}
    </div>


{% endblock %}

{% block functionsjs %}

    <script>

        var myshdwnurl="{% url 'ipol.cp.archive.shutdown' %}";
        //console.log(myshdwnurl);
        function send_archive_shutdown_request() {
            var confirmshutdown = confirm(' Dou You Want to shutdown Archive Module?');
            if (confirmshutdown == true) {

                $.ajax({
                    type: 'GET',
                    url: myshdwnurl,
                    dataType: 'json',
                    success: function (data) {
                        //console.error(data.status);
                        var okhtml = "<p class=\"ststsnok\">Archive Module Shutdown successfull</p>";
                        $('#archive_module_info').html(okhtml);

                    },
                    error: function (data) {
                        var errorhtml = "<p>Could not shutdown properly, refresh page</p>";
                        $('#archive_module_info').html(errorhtml);
                    }
                });
            }
        }


        function send_add_test_to_test_demo(wsurl) {
            var addexp = confirm('Add exp to test demo (id=-1)' );
            if (addexp == true) {

                $.ajax({
                    type: 'GET',
                    url: wsurl,
                    dataType: 'json',
                    success: function(data) {
                        location.reload();

                    },
                    error: function(data){
                        alert("nok error adding experiment")
                    }
                });
            }
        }

    </script>

{% endblock %}
