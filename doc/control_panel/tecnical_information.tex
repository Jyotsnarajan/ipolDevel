\subsection{Tecnical information}
In this section we'll discuss the project's structure and how to deploy it in diferent enviroments
This module is implemented using Django framework so we'll explain some basic information about how to configure a django web app.
The use or virtualenv is recomended.

\subsection{Project structure}
This is the Django project structure.
One project ipolwebapp with one app named controlpanel.

Describe folders.

\begin{itemize}
\item  apps
This folder is where you the apps you create for the ipol\_webapp project should go.There is only one app at this time, controlpanel.
\item  apps\/controlpanel
Is the folder of the controlpanel app, it contaisn folder and some import files , like models.py that contains the controlpanel app model, beacuse controlpanel only uses the services provided by the modules, it does not have a model, its does not store any data from the modules in its DB (it does stores user prfiles information so you can login and more stuff so the app can work )
\item  apps\/controlpanel\/controlpanel\_static
Staic files go in this folder, js, css etc.
\item  apps\/controlpanel\/templates
Templates for each module, each module has a folder.
\item  apps\/controlpanel\/views
Here you have the business logic code. you will find a .py file for each module
\item  apps\/controlpanel\/views\/ipolwebservices
Here you have code that allows controlpanel to access the diferent webservices, 
ipolwsurls.py contains the name of the services that controlpanel will need
ipolservices.py contains functions that make the call using the service names provided by ipolwsurls.py to the proper module.
ipoldeserializers.py provides code to deserialize the json returned by the ws and conver it to python objects. This is donde for complex objects like lists. They are reused in many places. 
\item  bin
Empty at the present moment, contains deployment scripts
\item  docs
Howto docs
\item  ipol\_webapp
The project folder, contains the main configuration files.
\item  tests
Empty at the present moment,Unit tests shoul go here.
\item  vendor
External apps that require adaptation to project. (you cant just install them with pip and use.)
The only app that has been adapted is allauth. Its installed with pip like the rest, but in vendors I provide adaptos and templates so I can customize allauth.
\end{itemize}

Describe important/configuration files

\begin{itemize}
\item  ipol\_webapp\/settings.py
This is the main configuration file, it contains the list of apps installed (INSTALLED\_APPS), the configuration of django and all the apps included in the project (if they need any configuration), the configuration of i18n translations, the logers, the static and media folders,the templates, the databases, the middleware, the cache (memcache is configured but not used) and at the begining of the file there's a first section that looks for the name of the machine the app is running on, and depending on the hostname it loads settings for the local environment or the development environment.

If you want to run this app locally, you must add the hostname of your machine to the local\_machines list, 
to run on a dev machine,add the hostname of your machine to dev\_machines.

Local and development machines can runn wih debug = True and no cache, and they can use the runserver provided by django

For a production enviroment, you must add the hostname of your machine to the production\_machines list,  DEBUG must be false, the use of memcache is recommended, and you must serve staicfiles properly. A proper server must be provided (apache naginx gunicorn...etc there are many recepies for a django deployment), YOU MUST NEVER USE RUNSERVER for production.
 

\item  ipol\_webapp\/urls.py
It contais a list of url patterns, 
A simple example:
\begin{lstlisting}[language=Python,firstnumber=1]
url(r'^status/', StatusView.as_view(), name="ipol.cp.status")
\end{lstlisting}
When http://hostname/status/ is entered in the webbrowser, Django will look in url.py for a match, an then the code in StatusView will run and prepare the data that will be shown in the template defined in the StatusView Class.
ipol.cp.status is the name I use to generate this url in my code or templates. this way you can avoid using hardcoded urls.

\item  ipol\_webapp\/wsgi.py
Automaticly generated by django when project was created.

\item  ipol\_webapp\/apps\/controlpanel\/urls.py
Controlpanel urls.

\item  db.sqlite3
The database.

\item  requirements.txt
The Requirements file, it contains the pip packages the project needs to satify dependencies. And commented you'll find tips telling you how to install them. 
\begin{lstlisting}[language=Python,firstnumber=1]
pip install -r "requirements.txt"
\end{lstlisting}

\item  tests
Unit tests, not implemented yet.

\item  vendor
Customized django apps, only allauth (for user login ) at the present moment. Theres adaptes and templates to get the allauth app inegrated in the ipol\_webapp project.

\end{itemize}


\subsubsection{Apps}
Describe the external apps ipolwebapp uses and why it needs them.

\subsubsection{Model}
The model of ipolwebapp

\subsubsection{Learning Django}
Django is a high-level Python Web framework that encourages rapid development and clean, pragmatic design. Built by experienced developers, it takes care of much of the hassle of Web development, so you can focus on writing your app without needing to reinvent the wheel. Itâ€™s free and open source.

Django usefull information:

Django project - \url{https://www.djangoproject.com/}

\subsection{Deployment}
For testing you can run it using runserver as described in ipol\_Webapps docs folder
But for a production enviroment you should not use runserver. Apache or nginx as a reverse proxy and gunicorn is recomended.

This is how a deploymant is made

\begin{itemize}
\item  ssh to server 
\item  load virtualviroment (if using virtualenv)
\begin{lstlisting}[language=Python,firstnumber=1]
(ipol_virtual_env)user@prodmachine:/Users/myuser$
cd /Users/myuser/myvenvs/ipol_virtual_env
source bin/activate
(ipol_virtual_env)user@prodmachine:/Users/myuser/myvenvs/ipol_virtual_env$
cd /var/www/Ipol_webap
(ipol_virtual_env)user@prodmachine:/var/www/Ipol_webap$ 
python manage.py 
\end{lstlisting}
\item  get code from git
\item  migrations
This is to aply changes in the model or installed app's models, so changes are aplied to the database without having to delete and recreate the database.
\begin{lstlisting}[language=Python,firstnumber=1]
python manage.py migrate  --list
python manage.py migrate
\end{lstlisting}
\item  Start/ restart aplication server
\item  Start/ restart static files aplication server (if any)

\end{itemize}



\subsubsection{Test Enviroment}
For the test enviroment you can use the testing server that comes with django.

\begin{lstlisting}[language=Python,firstnumber=1]
 (ipol_virtual_env)user@devmachine:/var/www/Ipol_webap$ 
 python manage.py migrate  --list
 
 (ipol_virtual_env)user@devmachine:/var/www/Ipol_webap$ 
 python manage.py collectstatic
 
 (ipol_virtual_env)user@devmachine:/var/www/Ipol_webap$ 
 nohup python manage.py runserver 0.0.0.0:8000 &./dev/null &
\end{lstlisting}


\subsubsection{Production Enviroment}
The production eviroment requires a secure deployment, yo cannot user runserver. An example could be apache as reverse proxy and for serving static content and gunicorn as application server. Nginx is also a popular application server used for Django apps.


Django deployment tutorial:

\url{http://pyvideo.org/video/236/pycon-2010--django-deployment-workshop}


Django-Nginx-Gunicorn setup:

Nginx - \url{http://nginx.org/en/docs/}
Gunicorn - \url{http://docs.gunicorn.org/en/latest/deploy.html}


Django-Nginx setup:

Django-Nginx - \url{http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html}


Django-Apache setup:

Apache2 - \url{https://httpd.apache.org/}
Apache mod\_wsgi - \url{http://thecodeship.com/deployment/deploy-django-apache-virtualenv-and-mod_wsgi/}



\subsubsection{Manage static content in Production Enviroment }
Here describe how to setup static content with apache or nginx. find tutorials

Django project:

\url{http://blog.yourlabs.org/post/30382323418/surviving-djangocontribstaticfiles-or-how-to}

To collect static files run from the project folder:
\begin{lstlisting}[language=Python,firstnumber=1]
 (ipol_virtual_env)user@prodmachine:/var/www/Ipol_webap$ 
 python manage.py migrate  --list
 
 (ipol_virtual_env)user@prodmachine:/var/www/Ipol_webap$ 
 python manage.py collectstatic
\end{lstlisting}