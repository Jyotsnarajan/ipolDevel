\section{The Core module}
The core is the centralized controller of the whole IPOL demo system. It controls the execution of the experiments and delegates tasks such as data pre-processing (Conversion module), execution dispatching (Dispatcher module), algorithm execution (DemoRunner module), archiving experiments (Archive module), retrieving metadata, among others. It also handle notifications due to failures during a demo execution, bad constructed DDL's or any problem that must be notified to the demo user, the technical staff or the IPOL editors.

When an execution is requested, it obtains first the textual description of the corresponding demo (its DDL) from the DemoInfo module. Then, it asks for the workload of the different DemoRunners and gives this information to the Dispatcher module in order to pick the best DemoRunner according to the Dispatcher's selection policy. The following step is to ensure that the source codes are well compiled and updated in the chosen DemoRunner and that the demoextras (scripts or data) of the given demo correctly works. You can see more details about DemoExtras in the following section.

Next, the core creates a run folder, copies the input data chosen by the users in this folder and delegates the pre-process of these ones to the conversion module, according to the DDL specification or if a crop has been required. This run folder is identified by an unique key and it is created into a shared folder. This sharing is done by using an ssh protocol. Thanks to this, all the demorunner machines can access to the shared folder where are stored the executions and the demoextras of each demo. 

Once the execution is ready, the DemoRunner runs the algorithm with the parameters and inputs set by the user while the Core waits until the execution has finished or a timeout happens. Finally, it delegates into the Archive module to store the results of the experiment. 

In case of any failures, the Core terminates the execution and stores the errors in its log file. Eventually, it will send warning emails to the technical staff of IPOL (internal error) or to the IPOL editors of the article (compilation or execution failure).

\ToDo{Document the run program of the Core, and which are the main operations which are performed and which are delegated. For example: blob conversion, copy blobs, ask the dispatcher for the best demoRunner according to a policy chosen by the Core, send the execution to a demoRunner, delegate in Archive to store the results if needed, etc. It should also be explained the shared folder.}

\subsection{DemoExtras}

For the execution of some demos it is necessary some extra files called DemoExtras. Those files are stored in a compressed file (.tar.gz) in the demoinfo module. Also, a copy of this compressed file is stored in the ``dl\_extras'' folder in the ``shared\_folder'' for comparison reasons.

The first time a DemoExtra is found, the core uncompress the file into ``DemoExtras'' folder in the ``shared\_folder''. And in each execution the core checks the date and the size of the compressed file in the ``shared\_folder'' with the one stored in demoinfo.

The possible results from the check are:
\begin{itemize}
 \item \textbf{Date and size match:} Nothing is done
 \item \textbf{Date or size don't match:} The DemoExtra is downloaded again
 \item \textbf{DemoExtra deleted in demoinfo:} All DemoExtras files related to that demo are deleted in the ``share\_folder''
\end{itemize}

\subsection{Failure detection in demoExtras script}

Demos can fail while executing the demoextras run script. These errors can occur because of many reasons, from user input to not meeting demo 
requirements. The editors have the possibility to pipe error messages into a file called "demo\_failure.txt" and stop the execution with exit
code 0. This way the interface can show this error and this allows the demo to perform checks before the actual execution of the algorithm.

In order to use this mechanism the editor just needs to edit the script in the demoExtras and write the error message to the demo\_failure.txt file. 
For example:
\paragraph{Example}:\\
\begin{verbatim}
if [ $1 -gt 100 ]
then
    echo "Image height too big" >> demo_failure.txt
    exit 0
fi
\end{verbatim} 