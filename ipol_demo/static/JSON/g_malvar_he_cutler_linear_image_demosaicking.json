{ 
  "general": { 
    "demo_title"            : "Malvar-He-Cutler Linear Image Demosaicking",
    "input_description"     : [ "<p>A linear image demosaicking method using optimized 5x5 filters.</p>" ],
    "param_description"     : 
      [
        "<p> ",
        "The algorithm runs in 2 steps:",
        "<ol>",
        "<li> a Bayer pattern mosaic is extracted from the input image;</li>",
        "<li> the demosaicking algorithm is used to reconstruct the original",
          "image.</li> ",
        "</ol>",
        "</p>",
        "Mosaicing patterns <br/>",
        "<table style='float:left;margin:5px;border:2px solid black'>",
          "<tr>",
            "<td style='color:white;background-color:red'>  R</td>",
            "<td style='color:white;background-color:green'>G</td>",
          "</tr>",
          "<tr>",
            "<td style='color:white;background-color:green'>  G</td>",
            "<td style='color:white;background-color:blue'>B</td>",
          "</tr>",
        "</table>",
        "<table style='float:left;margin:5px;border:2px solid black'>",
          "<tr>",
            "<td style='color:white;background-color:green'>G</td>",
            "<td style='color:white;background-color:red'>  R</td>",
          "</tr>",
          "<tr>",
            "<td style='color:white;background-color:blue'>B</td>",
            "<td style='color:white;background-color:green'>  G</td>",
          "</tr>",
        "</table>",
        "<table style='float:left;margin:5px;border:2px solid black'>",
          "<tr>",
            "<td style='color:white;background-color:green'>  G</td>",
            "<td style='color:white;background-color:blue'>B</td>",
          "</tr>",
          "<tr>",
            "<td style='color:white;background-color:red'>  R</td>",
            "<td style='color:white;background-color:green'>G</td>",
          "</tr>",
        "</table>",
        "<table style='float:left;margin:5px;border:2px solid black'>",
          "<tr>",
            "<td style='color:white;background-color:blue'>B</td>",
            "<td style='color:white;background-color:green'>  G</td>",
          "</tr>",
          "<tr>",
            "<td style='color:white;background-color:green'>G</td>",
            "<td style='color:white;background-color:red'>  R</td>",
          "</tr>",
        "</table> <div style='clear:both'><br/>"
      ],
    "enable_crop"           : true,
    "is_test"               : false,
    "xlink_article"         : "http://www.ipol.im/pub/art/2011/g_mhcd/"
  }, 
  "build":
    {
      "url"           : "http://www.ipol.im/pub/art/2011/g_mhcd/src.tar.gz", 
      "srcdir"        : "dmmalvar-src",
      "binaries"      : [ [".","dmmalvar"], [".","dmbilinear"], [".","mosaic"], [".","imdiff"]],
      "prepare_make"  : "sed -i -e 's/CFLAGS=/CFLAGS=-I\\\/usr\\\/include\\\/libpng12 /g' -e 's/lpng/lpng12/g' makefile.gcc",
      "flags"         : " --makefile=makefile.gcc -j4"
    }
  ,
  "inputs": [ 
      {
          "type"            : "image", 
          "description"     : "input",
          "max_pixels"      : "700*700",
          "max_weight"      : "10*1024*1024",
          "dtype"           : "3x8i",
          "ext"             : ".png"
      }
    ],
  "params": [
    {
      "id"            : "pattern",
      "type"          : "selection_collapsed",
      "label"         : "Mosaicing pattern",
      "values"        : { "RGGB":"RGGB", "GRBG":"GRBG", "GBRB":"GBRG", "BGGR":"BGGR" },
      "default_value" : "RGGB"
    }
  ]
  ,
  "run": [ 
    "mosaic     -p $pattern input_0.sel.png mosaiced.png ",
    "dmmalvar   -p $pattern mosaiced.png    malvar.png",
    "dmbilinear -p $pattern mosaiced.png    bilinear.png",
    "imdiff input_0.sel.png malvar.png      diffmalvar.png",
    "imdiff input_0.sel.png bilinear.png    diffbilinear.png",
    "python:sizeX=x1-x0;sizeY=y1-y0",
    "python:zoom_factor=max(1, int(math.ceil(200.0/min(sizeX, sizeX))))",
    "python:sizeX=sizeX*zoom_factor;sizeY=sizeY*zoom_factor",
    "convert -filter point -resize ${sizeX}x${sizeY} input_0.sel.png    input_0.sel_zoom.png",
    "convert -filter point -resize ${sizeX}x${sizeY} mosaiced.png       mosaiced_zoom.png",
    "convert -filter point -resize ${sizeX}x${sizeY} malvar.png         malvar_zoom.png",
    "convert -filter point -resize ${sizeX}x${sizeY} bilinear.png       bilinear_zoom.png",
    "convert -filter point -resize ${sizeX}x${sizeY} diffmalvar.png     diffmalvar_zoom.png",
    "convert -filter point -resize ${sizeX}x${sizeY} diffbilinear.png   diffbilinear_zoom.png",
    "python:self.algo_params['zoom_factor']=zoom_factor"
  ]
  ,
  "archive":
    {
      "files" : { 
                  "input_0.sel.png"     : "selected subimage",
                  "mosaiced.png"        : "mosaiced image",
                  "malvar.png"          : "Malvar demosaiced image",
                  "diffmalvar.png"        : "difference image for Malvar",
                  "bilinear.png"          : "bilinear demosaiced image",
                  "diffbilinear.png"        : "difference image for bilinear",
                },
      "params" :  [ "pattern" ]
    }
  ,
  "results": [
    {
      "type"          : "gallery",
      "label"         : "<h2>Resulting images</h2>",
      "contents"      : {
        "Mosaic"                      : "mosaiced_zoom.png",
        "Bilinear demosaiced"         : "bilinear_zoom.png", 
        "Malvar-He-Cutler demosaiced" : "malvar_zoom.png",
        "Original"                    : "input_0.sel_zoom.png",
        "Bilinear difference"         : "diffbilinear_zoom.png",
        "Malvar-He-Cutler difference" : "diffmalvar_zoom.png"
      },
      "style"         : "height:{{sizeY*ZoomFactor}}px"
    }
  ]

}