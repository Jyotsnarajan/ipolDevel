{ 
  "general": { 
    "demo_title"            : "Local Color Correction",
    "input_description"     : [ "" ],
    "param_description"     : [
      "The algorithm performs a local color correction.",
      "The 'locality' of the method depends upon a radius parameter r,",
      " that you can select. The default value of r is 10% ",
      "of the smallest dimension of the image."
    ],
    "enable_crop"           : true,
    "xlink_article"         : "http://www.ipol.im/pub/art/2011/gl_lcc/"
  }, 
  "build": [
    {
      "build_type"    : "make",
      "url"           : "http://www.ipol.im/pub/art/2011/gl_lcc/LCC.tar.gz", 
      "srcdir"        : "LCC",
      "binaries"      : [ [".","localcolorcorrection"] ],
      "prepare_make"  : "sed -i -e 's/-Werror//g' makefile",
      "flags"         : "-j4"
    } ]
  ,
  "inputs": [ 
      {
          "type"            : "image", 
          "description"     : "input",
          "max_pixels"      : "700*700",
          "max_weight"      : "10*1024*1024",
          "dtype"           : "3x8i",
          "ext"             : ".png"
      }
    ],
  "params": [
    {
      "id"            : "r_perc",
      "type"          : "range",
      "label"         :  [
          "Radius parameter <it>r</it> in % of the smallest dimension ",
          "of the selected image."
      ],
      "values"        : { "min":0, "max":49, "step":1, "default": 10 }
    },
    {
      "id"            : "rmax",
      "type"          : "readonly",
      "label"         : "Maximal radius parameter <it>rmax</it> in pixels",
      "value_expr"    : [ 
        "{{Math.floor((CropInfo.enabled?Math.min(CropInfo.coord.w,CropInfo.coord.h)/display_ratio:",
                                        "Math.min(imwidth,imheight)",
                      ")/2-1",
                    ")",
        "}}"
      ]
    },
    {
      "id"            : "r",
      "type"          : "readonly",
      "label"         : "Radius parameter <it>r</it> in pixels (readonly: computed from %)",
      "value_expr"    : [ 
        "{{",
          "demo.params[3].value=='global'?",
            "Math.floor((CropInfo.enabled?Math.min(CropInfo.coord.w,CropInfo.coord.h)/display_ratio:Math.min(imwidth,imheight))/2-1)",
          ":Math.floor((CropInfo.enabled?Math.min(CropInfo.coord.w,CropInfo.coord.h)/display_ratio:",
                                        "Math.min(imwidth,imheight)",
                      ")*demo.params[0].value/100",
                    ")",
        "}}"
      ]
    },
    {
      "id"            : "run_mode",
      "type"          : "selection_collapsed", 
      "label"         : "Locality",
      "values"        : { "local"   :"local", 
                          "global"  :"global"  },
      "default_value" : "local"
    }
  ]
  ,
  "run": [ 
      "localcolorcorrection input_0.sel.png output_1.png $r 1",
      "localcolorcorrection input_0.sel.png output_2.png $r 2",
      "localcolorcorrection input_0.sel.png output_3.png $r 3",
      "localcolorcorrection input_0.sel.png output_4.png $r 4",
      "image_histogram.py input_0.sel.png output_1.png output_2.png output_3.png output_4.png"
  ]
  ,
  "archive":
    {
      "files" : { 
                  "input_0.orig.png":"uploaded image",
                  "input_0s.png"    :"sub-image selection",
                  "input_0.sel.png" : "processed image",
                  "output_1.png"    : "result image 1 (RGB)",
                  "output_2.png"    : "result image 2 (I)"
                },
      "params" :  [ "r_perc", "r", "rmax", "run_mode" ]
    }
  ,
  "results": [
    {
      "type"          : "html_text",
      "contents"      : [
          "<p>",
              "Result 1: Color Correction on each color channel <br />",
              "Result 2: Color Correction on Intensity channel (keep original R/G/B ratios)  <br />",
              "Result 3: Color Correction on Y channel (use YPbPr color space)  <br />",
              "Result 4: Color Correction on L channel (use HSL color space)  <br />",
          "</p>",
          "<p>",
            "Histogram scale is set to the histogram size of the input image. ",
            "Dark colors indicate overflows and truncated bins.",
          "</p>"
        ]
    },
    {
      "type"          : "gallery",
      "label"         : "<h2>Resulting images</h2>",
      "contents"      : { 
        "Original" : { "image":"input_0.sel.png", "Histogram:R,G,B,I":"input_0.sel_hist.png" }, 
        "Result 1" : { "image":"output_1.png",    "Histogram:R,G,B,I":"output_1_hist.png" }, 
        "Result 2" : { "image":"output_2.png",    "Histogram:R,G,B,I":"output_2_hist.png" }, 
        "Result 3" : { "image":"output_3.png",    "Histogram:R,G,B,I":"output_3_hist.png" }, 
        "Result 4" : { "image":"output_4.png",    "Histogram:R,G,B,I":"output_4_hist.png" }
      },
      "style"         : "height:{{sizeY*ZoomFactor}}px"
    }
  ]

}