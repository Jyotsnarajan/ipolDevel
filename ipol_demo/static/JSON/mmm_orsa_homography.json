{ 
  "general": { 
    "demo_title"            :  "Automatic Homographic Registration of a Pair of Images, with A Contrario Elimination of Outliers",
    "input_description"     : "Please select or upload the image pair to register.",
    "param_description"     : "Choose the precision (in pixels) and run the registration process.",
    "enable_crop"           : true,
    "xlink_article"         : "http://www.ipol.im/pub/art/2012/mmm-oh/",
    "show_results_on_error" : true
  }, 
  "build": [
    {
      "build_type"    : "cmake",
      "url"           : "http://www.ipol.im/pub/art/2012/mmm-oh/OrsaHomography_20120515.tar.gz", 
      "srcdir"        : "OrsaHomography_20120515/src",
      "prepare_cmake" : "sed -i 's/FIND_PACKAGE(PNG)/#FIND_PACKAGE(PNG)/g' demo/libImage/CMakeLists.txt; sed -i 's/FIND_PACKAGE(PNG)/#FIND_PACKAGE(PNG)/g' third_party/png/CMakeLists.txt",
      "binaries"      : [ ["demo","demo_orsa_homography"] ],
      "flags"         : "-j4"
    } ]
  ,
  "inputs": [ 
      {
          "type"            : "image", 
          "description"     : "input 1",
          "max_pixels"      : "1600*1200",
          "max_weight"      : 5242880,
          "dtype"           : "3x8i",
          "ext"             : ".png"
      },
      {
          "type"            : "image", 
          "description"     : "input 2",
          "max_pixels"      : "1600*1200",
          "max_weight"      : 5242880,
          "dtype"           : "3x8i",
          "ext"             : ".png"
      }
    ]
  ,
  "params": [  
    {
      "id"            : "precision",
      "type"          : "selection_collapsed", 
      "label"         : "precision (in pixels)",
      "values"        : { "arbitrary":"0", 
                          "5":"5", 
                          "2":"2", 
                          "1":"1", 
                          "0.5":"0.5"
                         },
      "default_value" : "0"
    },
    {
      "id"            : "siftratio",
      "type"          : "selection_collapsed", 
      "label"         : "SIFT ratio (higher=more matches)",
      "values"        : { "0.6":"0.6", 
                          "0.8":"0.8", 
                          "1"  :"1", 
                          "1.1":"1.1" 
                          },
      "default_value" : "0.6"
    }
  ],
  "run": [
      "demo_orsa_homography input_0.png input_1.png match.txt matchOrsa.txt inliers.png outliers.png panorama.png registered_0.png registered_1.png -p $precision -s $siftratio -c ${x1-x0}x${y1-y0}+$x0+$y0 >stdout.txt",
      "count_lines.py matchOrsa.txt nb_inliers.txt",
      "count_lines.py match.txt     nb_matches.txt"
  ]
  ,
  "config":
    {
      "info_from_file": {  "inliers" : "nb_inliers.txt",
                           "matches" : "nb_matches.txt"
                        }
    }
  ,
  "archive":
    {
      "files" : { "input_0.orig.png"        : "uploaded #1",
                  "input_1.orig.png"        : "uploaded #2",
                  "input_0.png"             : "input #1",
                  "input_1.png"             : "input #2",
                  "outliers.png"            : "outliers image",
                  "inliers.png"             : "inliers image (if success)",
                  "panorama.png"            : "panorama (if success)",
                  "registered_0.png"        : "registered image #1 (if success)",
                  "registered_1.png"        : "registered image #2 (if success)"
                },
      "compressed_files" : {
                  "match.txt"               : "",
                  "matchOrsa.txt"           : "",
                  "stdout.txt"              : ""
                },
      "params" :  [ ],
      "info"   : {  
                    "x0": "x0",  
                    "y0": "y0",  
                    "x1": "x1",  
                    "y1": "y1",  
                    "precision": "precision", 
                    "siftratio": "siftration"
                  }
  },
  "results": [
    {
      "type"          : "gallery",
      "label"         : "<h2>Resulting Images</h2>",
      "contents"      : {
                          "Panorama"                   : "panorama.png", 
                          "Reg. image 1"               : "registered_0.png",
                          "Reg. image 2"               : "registered_1.png",
                          "inliers  {{info.inliers}}"  : "inliers.png",
                          "outliers {{info.matches-info.inliers}}" : "outliers.png",
                          "first image"                : "input_0s.png",
                          "second image"               : "input_1.png"
                        },
      "style"         : "{'width':imwidth+'px','height':imheight+'px'}" 
    },
    {
      "type"          : "file_download", 
      "label"         : "<h2>Downloads</h2>",
      "contents"      : { "Correspondences":"match.txt", "inliers":"matchOrsa.txt" }
    },
    {
      "type"          : "text_file", 
      "label"         : "<h2>Program Output<h2>",
      "contents"      : "stdout.txt",
      "style"         : "{'width':'50em','height':'20em'}"
    }
  ]
}