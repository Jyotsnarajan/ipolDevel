<%include file="header.html" />


<script>  
    IPOLDemosApp.value("demo_id","${app.id}");
    IPOLDemosApp.value("demo_key","${app.key}");
    IPOLDemosApp.value("work_url","${app.work_url}");  
    IPOLDemosApp.value("proxy_server",  "${app.proxy_server}"); 
</script>


<div ng-controller="DemoResultCtrl" >

<p>
  Execution time: {{info.run_time | number:2 }} sec.
<!--    {{info.run_time*(1024*1024)/(sizeX*sizeY) | number:2 }}s/(mÃ©gapixel:1024x1024).<br /> -->
<br/>
  Status : {{info.status}}
</p>
<span ng-if="info.status=='failure'">
  <p class="error"> {{info.error}} </p>
</span>


  <span ng-repeat="result in demo.results">
    <!-- warning -->
    <span ng-if="result.type==='warning'"> 
      <span ng-if="$eval(result.visible)">
        <p style='border: 1px solid; margin: 10px 0px; padding:15px 10px 15px 50px; color: #9F6000;'>
          <b><u>WARNING</u></b><br/><br/>
          <span bind-html-compile="result.contents"></span> <br/><br/>
        </p>
      </span>
    </span>
  </span>

  <!-- ===== Rerun ===== -->
  <div class="action">
    <form style="display:inline;" action="${app.base_url}" method="get">
      <input  style="border-radius:10px;font-size:14px!important;" 
              type="submit" value="Restart with new input data." />
    </form>
      <form style="display:inline;" action="${app.base_url + 'params'}" method="get">
        <input type="hidden" name="key" value="${app.key}">
        <input type="hidden" name="newrun" value="1">
        <input  style="border-radius:10px;font-size:14px!important;" 
                type="submit" value="Restart with different parameters and/or subimage." />
      </form>
  </div>

  <!-- ===== Display parameters if any ===== -->
  <span ng-if="demo.params.length>0">
    <h1>Parameters</h1>
    <ul ng-repeat="param in demo.params"
        ng-if="(param.visible===undefined)||$eval(param.visible)">
      <span ng-if="param.type==='label'"> 
        <b> <span  ng-bind-html="renderHtml(param.label)"></span> </b><br />
      </span>
      <li ng-if="param.type==='range'"> 
        <span  ng-bind-html="renderHtml(param.label)"></span> : {{params[param.id]}} 
      </li>
      <li ng-if="param.type==='range_scientific'"> 
        <span  ng-bind-html="renderHtml(param.label)"></span> : {{params[param.id]}} 
      </li>
      <li ng-if="param.type==='readonly'"> 
        <span  ng-bind-html="renderHtml(param.label)"></span> : {{params[param.id]}} 
      </li>
      <li ng-if="param.type==='selection_collapsed'"> 
        <span  ng-bind-html="renderHtml(param.label)"></span> : 
        <span ng-repeat="(key,value) in param.values  | withvalue:params[param.id]">
            <span ng-bind-html="renderHtml(key)"> </span> 
        </span>
      </li>
      <li ng-if="param.type==='selection_radio'"> 
        <span  ng-bind-html="renderHtml(param.label)"></span> : 
        <span ng-repeat="(key,value) in param.values  | withvalue:params[param.id]">
            <span ng-bind-html="renderHtml(key)"> </span> 
        </span>
      </li>
      <li ng-if="param.type==='checkbox'"> 
        <span  ng-bind-html="renderHtml(param.label)"></span> : {{(params[param.id]==true)}} 
      </li>
      <li ng-if="param.type==='checkboxes'"> 
        <span  ng-bind-html="renderHtml(param.label)"></span> : 
          <span  ng-repeat="group in param.values">
            <span ng-repeat="(id, label) in group" ng-if="params[param.id+'_'+id]==true">
              &nbsp; <span ng-bind-html="renderHtml(label)"></span>; &nbsp; 
            </span>
          </span>
      </li>
    </ul>
  </span>
<!--   <hr /> -->

  <!-- ===== Results ===== -->
  <h1>Results</h1>

  <!-- zoom factor for gallery -->
  <label> Zoom factor for images </label>
  <select ng-options="ZoomFactor for ZoomFactor in [0.125,0.25,0.5,0.75,1, 1.5, 2, 4, 8,16]" 
          ng-model="ZoomFactor" 
          ng-init="ZoomFactor=1">
  </select> <br/>

<!--   <span bind-html-compile="demo.results_test[0].contents.join('')"></span>  -->
<!--  <span bind-html-compile="'test '"> </span> 
{{"{{demo.general}}"|interpolate:current_scope}}-->

  <!-- display all results -->
  <span ng-repeat="result in ::demo.results"
        ng-if="(result.visible===undefined)||$eval(result.visible)" >
    <!-- gallery -->
    <span ng-if="result.type==='gallery'"> 
      <span bind-html-compile="joinHtml(result.label)"></span><br/>
      <div   class="gallery2" style="{{result.style|interpolate:current_scope}}">
        <ul class="index">
          <!-- if label contains '?' then interpret it as a condition 
                and filter labels -->
          <li   ng-repeat="(label,image) in result.contents" 
                 ng-if="CheckLabelCondition(label,current_scope)&&(result.status[$index]!='failed')" 
              >
            <!-- style="width:16em" -->
            <a href="#" style="width:16em" >
              <span bind-html-compile="GetLabel(label)" > </span> 
              <span ng-if="result.status[$index]!='loaded'"> (loading) </span>
              <!-- if image is a single string, load it from work_url -->
              <div class="galim" ng-if="CheckString(image)" style="left:16em" >
                  <img  style="{{result.style|interpolate:current_scope}}" 
                        ng-src="{{work_url+image|interpolate:current_scope}}" 
                        imageonfail="DisableImage(result.status,$index)"
                        imageonload="LoadedImage(result.status,$index)"
                  />
              </div>
              <!-- if image is an array of strings, load each string
                   from work_url and display them in a table -->
              <div class="galim" ng-if="CheckArray(image)" style="left:16em" >
                <table border="1">
                  <tr>
                    <td ng-repeat="im in image">
                      <img  style="{{result.style|interpolate:current_scope}}" 
                            ng-src="{{work_url+im|interpolate:current_scope}}" 
                            imageonfail="DisableImage(result.status,$parent.$index)"
                            imageonload="LoadedImage(result.status,$parent.$index)"
                      />
                    </td>
                  </tr>
                </table>
              </div>
              <!-- if image is an object: list of (label,image)
                   load each image from work_url and display them in a table 
                    with associated labels -->
              <div class="galim" ng-if="!CheckArray(image)&&CheckObject(image)" style="left:16em" >
                <table border="1">
                  <tr>
                    <td ng-repeat="(l,im) in image" style="text-align:center">
                      <img  style="{{result.style|interpolate:current_scope}}" 
                            ng-src="{{work_url+im|interpolate:current_scope}}" 
                            imageonfail="DisableImage(result.status,$parent.$index)"
                            imageonload="LoadedImage(result.status,$parent.$index)"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td ng-repeat="(l,im) in image" style="text-align:center">
                      <span bind-html-compile="l" > </span> 
                    </td>
                  </tr>
                </table>
              </div>
            </a>
          </li>
        </ul>
      </div>
      <br/>

    </span>
    <!-- repeat_gallery -->
    <span ng-if="result.type==='repeat_gallery'"> 
      <span bind-html-compile="result.label"></span><br/>
      <div class="gallery2" style="{{result.style|interpolate:current_scope}}" >
        <ul class="index">
          <li ng-repeat="idx in range($eval(result.repeat))" >
            <a href="#"> 
              <div bind-html-compile="result.contents[0]" > </div> 
              <span class="galim" ng-if="CheckArray(result.contents[1])===false">
                <img  style="{{result.style|interpolate:current_scope}}" 
                      ng-src="{{work_url+result.contents[1]|interpolate_loop:current_scope:idx}}"/> 
              </span>
              <span class="galim" ng-if="CheckArray(result.contents[1])">
                <table border="1">
                  <tr>
                    <td ng-repeat="im in result.contents[1]">
                      <img  style="{{result.style|interpolate:current_scope}}" 
                            ng-src="{{work_url+im|interpolate_loop:current_scope:idx}}"/> 
                    </td>
                  </tr>
                </table>
              </span>
            </a>
          </li>
        </ul>
      </div>
      <br/>
    </span>
    <!-- html_text -->
    <span ng-if="result.type==='html_text'"> 
      <div bind-html-compile="result.contents.join('')"></div> <br/>
    </span>
    <!-- file_download -->
    <span ng-if="result.type==='file_download'"> 
      <span ng-if="result.repeat!=undefined">
        <span ng-repeat="idx in range($eval(result.repeat))">
          <a href="{{work_url+result.contents|interpolate_loop:current_scope:idx}}">
            <div bind-html-compile="result.label"></div> <br/>
          </a>
        </span>
      </span>
      <span ng-if="result.repeat==undefined">
        <span ng-if="CheckObject(result.contents)">
            <span bind-html-compile="result.label"></span>
            <span ng-repeat="(label,file) in result.contents">
            &nbsp;[&nbsp;<a href="{{work_url+file}}">{{label|interpolate:current_scope}}</a>&nbsp;]&nbsp;
            </span>
        </span>
        <span ng-if="!CheckObject(result.contents)">
            <a href="{{work_url+result.contents}}"><span bind-html-compile="result.label"></span></a>
        </span>
        <br/><br/>
      </span>
    </span>
    <!-- text_file -->
    <span ng-if="result.type==='text_file'"> 
      <span bind-html-compile="result.label"></span><br/>
      <iframe src="{{work_url+result.contents}}" 
              style="{{result.style|interpolate:current_scope}}"/> </iframe>
    </span>
  </span>

</div>


<%include file="archive_info.html" />

<%include file="footer.html" />

