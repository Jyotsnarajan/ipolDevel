<%
    import urllib
    import json
    
    url_proxy_in_local = "http://127.0.0.1:9003/"
    request = '?module=archive&service=page&demo_id=' + app.id + '&page=1'
    #json_response = urllib.urlopen(app.proxy_server + request).read()
    json_response = urllib.urlopen(url_proxy_in_local + request).read()
    response = json.loads(json_response)
    status = response['status']
    
    if status == "OK":
        page = response['nb_pages']
        request = '?module=archive&service=page&demo_id=' + app.id + '&page=' + str(page)
        #json_response = urllib.urlopen(app.proxy_server + request).read()
        json_response = urllib.urlopen(url_proxy_in_local + request).read()
        response = json.loads(json_response)
        status = response['status']
        
        if status == "OK":
            
            experiments = response['experiments']
            archive_experiments = [{'id_experiment' : exp['id'], 'files' : exp['files'], 'date': exp['date'], 'parameters' : exp['parameters']}
                                for exp in experiments]
            
            length_experiments = len(archive_experiments) - 1
            last_experiment = archive_experiments[length_experiments]
            id_experiment = last_experiment['id_experiment']
            
            page = page
            id_experiment = id_experiment
            
            url_for_archive_details = 'archive?page=' + str(page) + '&id_experiment=' + str(id_experiment) 
            
            
%>


%if app.cfg['meta']['original']:
<div>
  <form action="" method="get">
    <p>
      <input type="hidden" name="key" value="${app.key}" />
      %if app.cfg['meta']['public']:
      This archive is public
      (<a href="${app.base_url + url_for_archive_details | h }" title="permalink">link</a>)
      and will appear in
      <a href="${app.base_url + 'archive' | h }">the archive index</a>.
      <br />
      <!-- TODO: use radio controls -->
      You can switch to private mode:
      <input type="hidden" name="set_public_archive" value="0" />
      <input type="submit" value="private" />.
      %else:
      This archive is not public and will not appear in
      <a href="${app.base_url + 'archive' | h }">the archive index</a>.
      Files will be deleted from the server after a few days.
      <br />
      You can switch to public mode:
      <input type="hidden" name="set_public_archive" value="1" />
      <input type="submit" value="public" />.
      %endif
      This setting will be remembered until you close your browser.
    </p>
  </form>
</div>
%endif
