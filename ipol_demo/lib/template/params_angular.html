<%include file="header.html" />


<!-- ======================================================================= -->
<!-- ======================================================================= -->
<!-- <hr> -->
<script>  
    IPOLDemosApp.value("demo_id",       "${app.id}");
    IPOLDemosApp.value("demo_key",      "${app.key}");
    IPOLDemosApp.value("proxy_server",  "${app.proxy_server}"); 
</script>

<div ng-controller="DemoParamCtrl">
  <span ng-bind-html="renderHtml(demo.general.param_description)"> </span>
  <form action="${app.base_url + 'rectangle'}" method="get">
    <div class="action" style="align:left;margin-bottom=20px;margin-top=20px" >
      <input type="hidden" name="key" value="${app.key}">

      <div ng-if="demo.params.length>0">

      <span ng-repeat="param_group in demo.params_layout">

      <fieldset style="display: inline-block;">
      <legend>{{param_group[0]}}</legend>
      <!--===================================================================-->
      <table  style="float:left;border:0px;"> 
        <!--=================================================================-->
        <tr style="border:0px;" 
            ng-repeat="pos in param_group[1]" 
            ng-if="(demo.params[pos].visible===undefined)||$eval(demo.params[pos].visible)"
            >
          <!--===============================================================-->
          <!-- selection_collapsed type -->
          <td style="border:0px;max-width:34em" ng-if="demo.params[pos].type==='selection_collapsed'"> 
            <label> <span ng-bind-html="renderHtml(demo.params[pos].label)"> </span> </label>  
          </td>
          <td style="border:0px;" ng-if="demo.params[pos].type==='selection_collapsed'" colspan="2">
              <select  ng-model="demo.params[pos].value" name="{{demo.params[pos].id}}"> 
                <option ng-repeat="(key, value) in demo.params[pos].values"  value="{{value}}"> 
                    {{key}}
                    <!-- not allowed in html ... -->
                    <!-- <span ng-bind-html="renderHtml(key)"> </span>   -->
                </option>
              </select>
          </td>
          <td   style="border:0px;max-width:34em" 
                ng-if="demo.params[pos].type==='selection_collapsed'&&demo.params[pos].comments!=undefined"> 
              <label bind-html-compile="demo.params[pos].comments"> </label>  
          </td>
          <!--===============================================================-->
          <!-- selection_radio type -->
          <td style="border:0px;max-width:34em" ng-if="demo.params[pos].type==='selection_radio'"> 
            <label> <span ng-bind-html="renderHtml(demo.params[pos].label)"> </span> </label>  
          </td>
          <td style="border:0px;" ng-if="demo.params[pos].type==='selection_radio'" colspan="2">
            <span ng-repeat="(key, value) in demo.params[pos].values"> 
                <label>
                    <input  type="radio" ng-model="demo.params[pos].value" 
                            name="{{demo.params[pos].id}}"
                            ng-value="value"> 
                  <span ng-bind-html="renderHtml(key)"> </span> 
                <label> &nbsp;
                <br ng-if="demo.params[pos].vertical!==undefined && demo.params[pos].vertical">
            </span> 
          </td>
          <td   style="border:0px;max-width:34em" 
                ng-if="demo.params[pos].type==='selection_radio'&&demo.params[pos].comments!=undefined"> 
              <label bind-html-compile="demo.params[pos].comments"> </label>  
          </td>
          <!--===============================================================-->
          <!-- range type -->
          <td  style="border:0px;max-width:34em" ng-if="demo.params[pos].type==='range'"> 
                <label bind-html-compile="demo.params[pos].label"> </label>
          </td>
          <td style="border:0px;width:5em" ng-if="demo.params[pos].type==='range'" >
            <input  style="width:100%"  type="number" name="{{demo.params[pos].id}}"
                    min="{{demo.params[pos].values.min}}" max="{{demo.params[pos].values.max}}" 
                    step="{{demo.params[pos].values.step}}" 
                    ng-model="demo.params[pos].value"/>
          </td>
          <td ng-if="demo.params[pos].type==='range'" style="border:0px;width:24em">
              <input  style="width:100%" type="range"  
                      min="{{demo.params[pos].values.min}}" max="{{demo.params[pos].values.max}}"
                      step="{{demo.params[pos].values.step}}"
                      ng-model="demo.params[pos].value" 
                      floatsaving />
          </td>
          <td   style="border:0px;max-width:34em" 
                ng-if="demo.params[pos].type==='range'&&demo.params[pos].comments!=undefined"> 
              <label bind-html-compile="demo.params[pos].comments"> </label>  
          </td>
          <!--===============================================================-->
          <!-- range_scientific type -->
          <td  style="border:0px;max-width:34em" ng-if="demo.params[pos].type==='range_scientific'"> 
              <label bind-html-compile="demo.params[pos].label"> </label>  
          </td>
          <td style="border:0px;width:5em" ng-if="demo.params[pos].type==='range_scientific'" >
            <input  style="width:100%"  type="number" name="{{demo.params[pos].id}}"
                    value="{{sci2str(demo.params[pos].value_slider,demo.params[pos].values.digits)}}"
                    readonly/>
          </td>
          <td ng-if="demo.params[pos].type==='range_scientific'" style="border:0px;width:24em">
              <input  style="width:100%" type="range"  
                      min="{{num2sci(demo.params[pos].values.min,demo.params[pos].values.digits)}}" 
                      max="{{num2sci(demo.params[pos].values.max,demo.params[pos].values.digits)}}"
                      step="1"
                      ng-model="demo.params[pos].value_slider" 
                      floatsaving />
          </td>
          <td   style="border:0px;max-width:34em" 
                ng-if="demo.params[pos].type==='range_scientific'&&demo.params[pos].comments!=undefined"> 
              <label bind-html-compile="demo.params[pos].comments"> </label>  
          </td>
          <!--===============================================================-->
          <!-- readonly type -->
          <td style="border:0px;max-width:34em" ng-if="demo.params[pos].type==='readonly'"> 
              <label bind-html-compile="demo.params[pos].label"> </label>
          </td>
          <td style="border:0px;" ng-if="demo.params[pos].type==='readonly'" colspan="2"  >
            <input  style="20em"  
                    type="text" 
                    name="{{demo.params[pos].id}}" 
                    value="{{demo.params[pos].value_expr.join('')|interpolate:current_scope}}"
                    readonly/>
          </td>
          <!--===============================================================-->
          <!-- label type -->
          <th style="border:0px;" ng-if="demo.params[pos].type==='label'" colspan=3> 
              <div  ng-bind-html="renderHtml(demo.params[pos].label)"></div> 
          </th>
          <!--===============================================================-->
          <!-- checkbox type -->
          <td style="border:0px;max-width:34em" ng-if="demo.params[pos].type==='checkbox'" align="left"> 
            <label>
              <span ng-bind-html="renderHtml(demo.params[pos].label)"> </span> 
            </label>
          </td>
          <td style="border:0px;" ng-if="demo.params[pos].type==='checkbox'" colspan="2" align="left"> 
            <input  type="checkbox" name="{{demo.params[pos].id}}" ng-model="demo.params[pos].value" />
            <input  type="text" name="{{demo.params[pos].id}}_checked" 
                    value="{{demo.params[pos].value==true}}" hidden />
          </td>
          <td   style="border:0px;max-width:34em" 
                ng-if="demo.params[pos].type==='checkbox'&&demo.params[pos].comments!=undefined"> 
              <label bind-html-compile="demo.params[pos].comments"> </label>  
          </td>
          <!--===============================================================-->
          <!-- checkboxes type -->
          <td style="border:0px;max-width:34em" ng-if="demo.params[pos].type==='checkboxes'" align="left"> 
            <label>
              <span ng-bind-html="renderHtml(demo.params[pos].label)"> </span> 
            </label>
          </td>
          <td style="border:0px;"  ng-if="demo.params[pos].type==='checkboxes'" colspan="2" align="left"> 
            <!--            <input type="button" value="all"  />
            <input type="button" value="none"  /><br/>-->
            <div  ng-repeat="group in demo.params[pos].values" >
<!--                   style="float:left;" > -->
<!-- margin-left:1em;margin-right:1em;margin-bottom:6pt"> -->
              <span ng-repeat="(id, label) in group">
                <input  type="checkbox" name="{{demo.params[pos].id}}_{{id}}" id="{{id}}" 
                        ng-model="demo.params[pos].cb_values[id]" />
                <input  type="text" name="{{demo.params[pos].id}}_{{id}}_checked"  
                        value="{{demo.params[pos].cb_values[id]==true}}" hidden/>
                <label for="{{id}}" ng-bind-html="renderHtml(label)">  </label> &nbsp;&nbsp;
<!--                 <br />  -->
              </span>
                <br /> 
            </div>
          </td>
          <td   style="border:0px;max-width:34em" 
                ng-if="demo.params[pos].type==='checkboxes'&&demo.params[pos].comments!=undefined"> 
              <label bind-html-compile="demo.params[pos].comments"> </label>  
          </td>
          <!--===============================================================-->
        </tr>
        <!--=================================================================-->
      </table>
      </fieldset>
      </span>

      </div>

      <span ng-if="CropInfo.enabled">
        <input type="hidden" name="x0" value="{{Math.round(CropInfo.coord.x/display_ratio)}}">              
        <input type="hidden" name="y0" value="{{Math.round(CropInfo.coord.y/display_ratio)}}">
        <input type="hidden" name="x"  value="{{Math.round((CropInfo.coord.x+CropInfo.coord.w)/display_ratio)}}">
        <input type="hidden" name="y"  value="{{Math.round((CropInfo.coord.y+CropInfo.coord.h)/display_ratio)}}">
      </span>
      <span ng-if="!CropInfo.enabled">
        <input type="hidden" name="x0" value="0">              
        <input type="hidden" name="y0" value="0">
        <input type="hidden" name="x"  value="{{imwidth}}">
        <input type="hidden" name="y"  value="{{imheight}}">
      </span>

      <div style="clear:both"> </div>
      <div style="text-align:left;float:left">
            <input type="submit" name="action" value="Run" /> <br/> <br/>
      </div>

    </div> <!-- action -->
  </form>



    <div style="clear:both"> </div>
    <!--       <hr> -->
    <div style='vertical-align:middle;
                margin-left:auto; margin-right: auto;
                text-align:center;  margin-bottom=20px;margin-top=20px'>

        <!--  if enable_crop possible -->
        <span ng-if="(demo.general.enable_crop===undefined)||(demo.general.enable_crop===true)">
        <div ng-controller="ImgCropCtrl"> 
           <div style="text-align:left;float:left">
              <input 
                      id="ID_InputCropped" type="checkbox" 
                      ng-model="CropInfo.enabled"  
                      alt="Crop"
                      > Enable Crop <br/> <br/>
          </div>
          <div style="clear:both"> </div>

          <!-- if crop disabled -->
          <div ng-if="!CropInfo.enabled" >
            <!-- use gallery only if several images -->
            <div ng-if="demo.inputs.length>1">
              <div class="gallery2" style="height:{{imheight*display_ratio+5}}px;">
                <ul class="index">
                  <li ng-repeat ="idx in range(demo.inputs.length)" 
                      ng-if     = "demo.inputs[idx].type=='image' || $eval('meta.input'+idx+'_has_image')">
                    <a href="#"> 
                      <span bind-html-compile="::demo.inputs[idx].description" > </span> 
                      <span ng-if="demo.inputs[idx].status!='loaded'"> (loading) </span>
                      <div class="galim">
                        <img  id="original_image"
                              crossOrigin="Anonymous"
                              ng-src="tmp/{{::demo_key}}/input_{{idx}}.png"
                              ng-style="{'padding':'5px',
                                      'max-width':maxdim+'px',
                                      'max-height':maxdim+'px',
                                      'width':'auto','height':'auto'}"
                              styleParent
                              imageonfail="DisableImage(demo.inputs[idx])"
                              imageonload="LoadedImage (demo.inputs[idx])"
                              />
                      </div>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <!-- otherwise simple image output -->
            <div ng-if="demo.inputs.length==1">
              <img  crossOrigin="Anonymous"
                    ng-src="tmp/{{::demo_key}}/input_0.png"
                    ng-style="{'padding':'5px',
                            'max-width':maxdim+'px',
                            'max-height':maxdim+'px',
                            'width':'auto','height':'auto','float':'left'}"
                    styleParent
                    />
              <div style="clear:both"> </div><br/>
            </div>
          </div>

          <!-- using ng-if instead of ng-show solved refreshing problem and canvas size set to 0x0 -->
          <!-- if crop enabled -->
          <div ng-if="CropInfo.enabled" > 
            <table  style="float:left;border:0px;border-collapse:collapse" >
              <tr style="border:0px">
                <td ng-style="{'vertical-align':'middle','width':(imwidth<maxdim)?(imwidth+10):(maxdim+10)+'px','border':'0px'}">
                    <div ng-style="{'width':imwidth*display_ratio+'px','height':imheight*display_ratio+'px','margin':'5px'}"
                        class="cropArea" >
                      <img-crop  
                                crossOrigin="Anonymous"
                                image="crop_image_url"
                                result-image="myCroppedImage"
                                change-on-fly="true"
                                area-type="{{type}}"
                                area-coords="CropInfo.coord"
                                enable="CropInfo.enabled"
                                area-min-size="CropInfo.minsize"
                                area-max-size="{{demo.general.crop_maxsize|interpolate:current_scope}}"
                          />
                    </div>
                    <label> dim = {{imwidth}} x {{imheight}}; display ratio = {{display_ratio | number : 2}};
                    </label>
                    <label>
                      crop = {{Math.round(CropInfo.coord.x/display_ratio)}}, {{Math.round(CropInfo.coord.y/display_ratio)}}, 
                      {{Math.round((CropInfo.coord.x+CropInfo.coord.w)/display_ratio)}}, 
                      {{Math.round((CropInfo.coord.y+CropInfo.coord.h)/display_ratio)}}
                    </label>
                </td>
                <td style='vertical-align:middle;border:0px;float:left'>
                  <select style="float:left"  ng-options="CropSize for CropSize in ['expand',1, 1.5, 2, 4, 8,16]" 
                          ng-model="CropSize" 
                          ng-init="CropSize='expand'" id="zoomfactor">
                  </select>
                  <label style="float:left" for="zoomfactor"> &nbsp;&nbsp; Zoom factor </label>
                  <div style="clear:both">
                  <div  ng-show="CropInfo.enabled" 
                        ng-style="{'overflow':'scroll',
                                'width':(imwidth*display_ratio+20)+'px',
                                'height':(imheight*display_ratio+20)+'px','float':'left'}" >
                    <div ng-if="CropSize!='expand'">
                      <img  style="float:left" crossOrigin="Anonymous" ng-src="{{myCroppedImage}}" 
                            width="{{CropInfo.coord.w*CropSize}}" 
                            height="{{CropInfo.coord.h*CropSize}}" />
                    </div>
                    <div ng-if="CropSize=='expand'">
                      <img  style="float:left" crossOrigin="Anonymous" ng-src="{{myCroppedImage}}" 
                            width= "{{CropInfo.coord.w*Math.min(imwidth/CropInfo.coord.w,imheight/CropInfo.coord.h)*display_ratio}}" 
                            height="{{CropInfo.coord.h*Math.min(imwidth/CropInfo.coord.w,imheight/CropInfo.coord.h)*display_ratio}}" />
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
          <div style="clear:both"> </div>
        </div>  <!-- ImCropCtrl -->
        </span> <!-- if crop enabled -->

        <!-- Crop disabled -->
        <span ng-if="(demo.general.enable_crop!==undefined)&&(demo.general.enable_crop===false)">
            <!-- if several inputs, use gallery -->
            <div ng-if="demo.inputs.length>1">
                <div class="gallery2" ng-style="{'height':(imheight*display_ratio+5)+'px'}">
                    <ul class="index">
                    <li ng-repeat = "idx in range(demo.inputs.length)" 
                        ng-if     = "demo.inputs[idx].type=='image' || $eval('meta.input'+idx+'_has_image')">
                        <a href="#"> 
                        <span bind-html-compile="::demo.inputs[idx].description" > </span> 
                        <span ng-if="demo.inputs[idx].status!='loaded'"> (loading) </span>
                        <div class="galim">
                            <img  id="original_image"
                                crossOrigin="Anonymous"
                                ng-src="tmp/{{::demo_key}}/input_{{::idx}}.png"
                                ng-style="{'padding':'5px','max-width':maxdim+'px',
                                        'max-height':maxdim+'px',
                                        'width':'auto','height':'auto'}"
                                alt="{{::demo.inputs[idx].description}}"
                                styleParent
                                imageonfail="DisableImage(demo.inputs[idx])"
                                imageonload="LoadedImage (demo.inputs[idx])"
                                />
                        </div>
                        </a>
                    </li>
                    </ul>
                </div>
            </div>
            <!-- otherwise display the only image -->
            <div ng-if="demo.inputs.length==1">
                <!-- deal with inpainting mask -->
                <span ng-if="(demo!=={})&&(demo.general.inpainting!==undefined)&&(demo.general.inpainting)">
                    <form action="${app.base_url + 'inpainting_editmask'}" method="get">
                        <input type="hidden" id="key" name="key" value="${app.key}" />

                        <p>Select an inpainting domain <i>D</i>:&nbsp;
                            <input type="submit" id="action" name="action" value="random text" />&nbsp;
                            <input type="submit" id="action" name="action" value="random walk" />&nbsp;
                            <input type="submit" id="action" name="action" value="random Bernoulli" />&nbsp;
                            (click again to regenerate)
                        </p>

                        <p>Alternatively, click on the image to draw the inpainting domain.</p>
                        <fieldset>    
                            <input type="submit" id="action" name="action" value="undo" style="float:left" />
                            <input type="submit" id="action" name="action" value="clear" style="float:left; margin-left:3pt" />
                            <div id="penpreview" name="penpreview" style="float:left; margin-left:36px; width:31px; height:31px"></div>
                            <div style="float:left; margin-left:6px; font-size:9pt; text-align:right;">
                                pen size&nbsp;&nbsp;&nbsp;
                                <input  type="text" style="font-family:monospace; text-align:right;"
                                        size="2" id="pensize" name="pensize" 
                                        ng-model="demo.params.pensize"
                                />
                                <br />

                                <input  style="width:8em; margin-top:2px; font-size:8pt;"  
                                        type="range" 
                                        min="1" max="15"  step="1" 
                                        ng-model="demo.params.pensize"/>


                            </div>
                            <input  type="submit" id="pencolor_yellow" name="pencolor_yellow" value="" 
                                    style="float:left; margin-left:36px; background:none; background-color:#FFFF00" />
                            <input  type="submit" id="pencolor_blue" name="pencolor_blue" value="" 
                                    style="float:left; margin-left:4px; background:none; background-color:#0000FF" />
                            <input  type="submit" id="pencolor_black" name="pencolor_black" value="" 
                                    style="float:left; margin-left:4px; background:none; background-color:#000000" />
                            <div style="clear:both"></div>
                            <input  type="image" 
                                    style="float:left; cursor:crosshair; margin-top:5px; background:url(tmp/{{::demo_key}}/input_0.png)"
                                    width="{{params.viewbox_width}}"
                                    height="{{params.viewbox_height}}"
                                    ng-src="{{'tmp/'+demo_key+'/mask.png'}}" 
                                    alt="" />
                        </fieldset>
                    </form>

                </span>
                <!-- no impainting: simple image display -->
                <span ng-if="(demo.general.inpainting==undefined)||(!demo.general.inpainting)">
                    <img  crossOrigin="Anonymous"
                        ng-src="tmp/{{::demo_key}}/input_0.png"
                        ng-style="{'padding':'5px',
                                'max-width':maxdim+'px',
                                'max-height':maxdim+'px',
                                'width':'auto','height':'auto','float':'left'}"
                        styleParent
                        />
                </span>
                <div style="clear:both"> </div><br/>
            </div>
        </span>
    </div>


    <p>
    <!-- show the remaining images below -->
    <div ng-if="CropInfo.enabled &&(demo.inputs.length>1)" class="gallery2" 
        ng-style="{'height':(imheight+5)+'px'}">
    <ul class="index">
        <li ng-repeat="idx in range(1,demo.inputs.length)"
            ng-if    = "demo.inputs[idx].type=='image' || $eval('meta.input'+idx+'_has_image')">
            <a href="#"> 
            <span bind-html-compile="demo.inputs[idx].description" > </span> 
            <div class="galim">
            <img  id="original_image"
                    crossOrigin="Anonymous"
                    ng-src="tmp/{{demo_key}}/input_{{idx}}.png"
                    ng-style="{'padding':'5px',
                            'max-width':maxdim+'px',
                            'max-height':maxdim+'px',
                            'width':'auto','height':'auto'}"
                    styleParent
                    />
            </div>
        </a>
        </li>
    </ul>
    </div>
    <p>

</div> <!-- DemoParamCtrl -->


<%include file="footer.html" />
